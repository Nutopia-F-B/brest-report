<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ù†Ø¸Ø§Ù… ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø© Ø§Ù„Ù…ØªØ·ÙˆØ±</title>

    <!-- React + ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>

    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Tailwind -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800&display=swap" rel="stylesheet">

    <style>
@media print {
    @page { 
        size: A4; 
        margin: 5mm;
    }

    body { 
        background-color: white; 
        font-size: 9pt !important;
        -webkit-print-color-adjust: exact !important; 
        print-color-adjust: exact !important; 
    }

    .no-print { display: none !important; }
    .page-container { padding: 0 !important; max-width: 100% !important; margin: 0 !important; }

    .branch-card, .diff-card { 
        border: 2px solid #000 !important; 
        box-shadow: none !important; 
        margin-bottom: 5px !important; 
        page-break-inside: avoid; 
        border-radius: 4px;
    }

    .branch-header, .diff-header { 
        padding: 2px 5px !important; 
        background-color: #e5e7eb !important; 
        border-bottom: 1px solid #000 !important; 
        color: black !important;
    }

    .branch-header h2, .diff-header span { 
        font-size: 10pt !important; 
        font-weight: 800 !important; 
        margin: 0 !important; 
    }

    th, td { 
        padding-top: 2px !important; 
        padding-bottom: 2px !important; 
        border-bottom: 1px solid #ddd !important; 
        line-height: 1.2;
        font-size: 9pt !important;
    }

    th { 
        background-color: #f3f4f6 !important; 
        color: black !important; 
        font-weight: 800 !important; 
        border-bottom: 1px solid #000 !important; 
    }

    h1 { font-size: 16pt !important; margin-bottom: 2px !important; }
    p { font-size: 9pt !important; margin: 0 !important; }
    .main-header { padding-bottom: 5px !important; margin-bottom: 5px !important; border-bottom: 2px solid #000 !important; }

    .print-break-after { 
        page-break-after: always !important; 
        break-after: page !important; 
        display: block; 
        height: 1px;
        margin-bottom: 0 !important; 
    }

    .details-table th, .details-table td {
        font-size: 8.5pt !important;
        background-color: #fafafa !important;
    }
}

        }
    </style>
</head>

<body>
    <div id="root"></div>

<script type="text/babel">

/* ---------------------------------------------
   Ø¥Ø¹Ø¯Ø§Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª GitHub
---------------------------------------------- */
/* ---------------------------------------------
   Ø¥Ø¹Ø¯Ø§Ø¯ GitHub Dispatch
---------------------------------------------- */
const GITHUB_USERNAME = "Nutopia-F-B";
const GITHUB_REPO = "brest-report";
const GITHUB_TOKEN = "x"; // ØªÙˆÙƒÙ† ÙˆÙ‡Ù…ÙŠ ÙÙ‚Ø· â€” Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ ÙÙŠ Secrets

async function saveDataToGitHub(newData) {

    const payload = {
        event_type: "update-data",
        client_payload: {
            data: JSON.stringify({ branches: newData }, null, 2)
        }
    };

    const response = await fetch(
        `https://api.github.com/repos/${GITHUB_USERNAME}/${GITHUB_REPO}/dispatches`,
        {
            method: "POST",
            headers: {
                "Accept": "application/vnd.github+json",
                "Authorization": "Bearer x", // GitHub Ø³ÙŠÙ‡Ù…Ù„ Ù‡Ø°Ù‡ Ø§Ù„Ù‚ÙŠÙ…Ø©
                "Content-Type": "application/json"
            },
            body: JSON.stringify(payload)
        }
    );

    if (response.ok) {
        alert("âœ”ï¸ ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ù„Ù‰ GitHub â€” Ø³ÙŠØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø®Ù„Ø§Ù„ 5 Ø«ÙˆØ§Ù†ÙŠ");
    } else {
        alert("âŒ ÙØ´Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ â€” Ø±Ø§Ø¬Ø¹ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª");
    }
}

/* ---------------------------------------------
   Ù‡Ù†Ø§ Ù†Ø¨Ø¯Ø£ React Components
---------------------------------------------- */

const { useState, useEffect, useRef } = React;

/* Ø¨ÙŠØ§Ù†Ø§Øª Ø§ÙØªØ±Ø§Ø¶ÙŠØ© (ÙÙŠ Ø­Ø§Ù„Ø© Ù„Ù… ÙŠØªÙ… Ø¬Ù„Ø¨ Ø´ÙŠØ¡ Ù…Ù† GitHub) */
const DEFAULT_DATA = [
    {
        id: 1,
        name: "Ù…Ø·Ø¹Ù… Ø¨Ø±ÙŠØ³Øª - ÙØ±Ø¹ Ø§Ù„Ø±ÙŠØ§Ù†",
        items: [
            { name: "Ø§Ù„Ø¨Ù†Ùƒ (Ù…Ø¯Ù‰/Ø§Ù†Ù…Ø§Ø¡)", foodics: 53398.0, actual: 53437.5, details: [] },
            { name: "ØªØ·Ø¨ÙŠÙ‚ Ø¬Ø§Ù‡Ø²", foodics: 85084.8, actual: 85085.8, details: [] },
            { name: "ØªØ·Ø¨ÙŠÙ‚ Ù†ÙˆÙ†", foodics: 2928.0, actual: 2928.0, details: [] },
            { name: "ØªØ·Ø¨ÙŠÙ‚ Ø°Ø§ Ø´ÙŠÙØ²", foodics: 20728.0, actual: 20556.0, details: [
                { date: "2024-01-15", note: "Ø®ØµÙ… Ø­Ù…Ù„Ø© ÙŠÙ†Ø§ÙŠØ±", amount: -100 },
                { date: "2024-01-20", note: "Ø¹Ù…ÙˆÙ„Ø© Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø·Ù„Ø¨ #442", amount: -72 }
            ] },
            { name: "ØªØ·Ø¨ÙŠÙ‚ Ø¨Ø±ÙŠØ³Øª", foodics: 16052.55, actual: 16052.55, details: [] },
            { name: "Ù‡Ù†Ù‚Ø±Ø³ØªÙŠØ´Ù†", foodics: 28351.0, actual: 28288.0, details: [] },
            { name: "ÙƒÙŠØªØ§", foodics: 94335.75, actual: 0, details: [] },
            { name: "ÙƒØ§Ø´", foodics: 7867.0, actual: 0, details: [] }
        ]
    },
    {
        id: 2,
        name: "Ù…Ø·Ø¹Ù… Ø¨Ø±ÙŠØ³Øª - ÙØ±Ø¹ Ø§Ù„ÙÙ„Ø§Ø­",
        items: [
            { name: "Ø§Ù„Ø¨Ù†Ùƒ (Ù…Ø¯Ù‰/Ø§Ù†Ù…Ø§Ø¡)", foodics: 28457.5, actual: 28462.5, details: [] },
            { name: "ØªØ·Ø¨ÙŠÙ‚ Ø¬Ø§Ù‡Ø²", foodics: 61550.6, actual: 61550.6, details: [] },
            { name: "ØªØ·Ø¨ÙŠÙ‚ Ù†ÙˆÙ†", foodics: 430.0, actual: 430.0, details: [] },
            { name: "ØªØ·Ø¨ÙŠÙ‚ Ø°Ø§ Ø´ÙŠÙØ²", foodics: 12131.0, actual: 12100.0, details: [] },
            { name: "ØªØ·Ø¨ÙŠÙ‚ Ø¨Ø±ÙŠØ³Øª", foodics: 43626.5, actual: 43626.5, details: [] },
            { name: "Ù‡Ù†Ù‚Ø±Ø³ØªÙŠØ´Ù†", foodics: 18067.0, actual: 18067.0, details: [] },
            { name: "ÙƒÙŠØªØ§", foodics: 73346.75, actual: 0, details: [] },
            { name: "ÙƒØ§Ø´", foodics: 5334.0, actual: 0, details: [] }
        ]
    },

    {
        id: 3,
        name: "Ù…Ø·Ø¹Ù… Ø¨Ø±ÙŠØ³Øª - ÙØ±Ø¹ Ø§Ø´Ø¨ÙŠÙ„ÙŠØ©",
        items: [
            { name: "Ø§Ù„Ø¨Ù†Ùƒ (Ù…Ø¯Ù‰/Ø§Ù†Ù…Ø§Ø¡)", foodics: 29666.0, actual: 29666.0, details: [] },
            { name: "ØªØ·Ø¨ÙŠÙ‚ Ø¬Ø§Ù‡Ø²", foodics: 59017.5, actual: 59017.5, details: [] },
            { name: "ØªØ·Ø¨ÙŠÙ‚ Ù†ÙˆÙ†", foodics: 1832.0, actual: 1832.0, details: [] },
            { name: "ØªØ·Ø¨ÙŠÙ‚ Ø°Ø§ Ø´ÙŠÙØ²", foodics: 16846.0, actual: 16846.0, details: [] },
            { name: "ØªØ·Ø¨ÙŠÙ‚ Ø¨Ø±ÙŠØ³Øª", foodics: 10411.0, actual: 10411.0, details: [] },
            { name: "Ù‡Ù†Ù‚Ø±Ø³ØªÙŠØ´Ù†", foodics: 21822.0, actual: 21822.0, details: [] },
            { name: "ÙƒÙŠØªØ§", foodics: 129723.1, actual: 0, details: [] },
            { name: "ÙƒØ§Ø´", foodics: 4822.5, actual: 0, details: [] }
        ]
    },

    {
        id: 4,
        name: "Ù…Ø·Ø¹Ù… Ø¨Ø±ÙŠØ³Øª - ÙØ±Ø¹ Ø§Ù„ØªØ¹Ø§ÙˆÙ†",
        items: [
            { name: "Ø§Ù„Ø¨Ù†Ùƒ (Ù…Ø¯Ù‰/Ø§Ù†Ù…Ø§Ø¡)", foodics: 35290.3, actual: 35294.8, details: [] },
            { name: "ØªØ·Ø¨ÙŠÙ‚ Ø¬Ø§Ù‡Ø²", foodics: 64726.2, actual: 64731.2, details: [] },
            { name: "ØªØ·Ø¨ÙŠÙ‚ Ù†ÙˆÙ†", foodics: 1686.0, actual: 1686.0, details: [] },
            { name: "ØªØ·Ø¨ÙŠÙ‚ Ø°Ø§ Ø´ÙŠÙØ²", foodics: 13329.0, actual: 13336.0, details: [] },
            { name: "ØªØ·Ø¨ÙŠÙ‚ Ø¨Ø±ÙŠØ³Øª", foodics: 30925.35, actual: 31004.65, details: [] },
            { name: "Ù‡Ù†Ù‚Ø±Ø³ØªÙŠØ´Ù†", foodics: 19062.0, actual: 19036.0, details: [] },
            { name: "ÙƒÙŠØªØ§", foodics: 109373.40, actual: 0, details: [] },
            { name: "ÙƒØ§Ø´", foodics: 4213.20, actual: 0, details: [] }
        ]
    },

    {
        id: 5,
        name: "Ù…Ø·Ø¹Ù… Ø¨Ø±ÙŠØ³Øª - ÙØ±Ø¹ Ø§Ù„Ø¹Ø§Ø±Ø¶",
        items: [
            { name: "Ø§Ù„Ø¨Ù†Ùƒ (Ù…Ø¯Ù‰/Ø§Ù†Ù…Ø§Ø¡)", foodics: 36210.0, actual: 36183.0, details: [] },
            { name: "ØªØ·Ø¨ÙŠÙ‚ Ø¬Ø§Ù‡Ø²", foodics: 65528.3, actual: 65492.3, details: [] },
            { name: "ØªØ·Ø¨ÙŠÙ‚ Ø°Ø§ Ø´ÙŠÙØ²", foodics: 13445.0, actual: 13445.0, details: [] },
            { name: "ØªØ·Ø¨ÙŠÙ‚ Ø¨Ø±ÙŠØ³Øª", foodics: 21448.1, actual: 21782.0, details: [] },
            { name: "Ù‡Ù†Ù‚Ø±Ø³ØªÙŠØ´Ù†", foodics: 19343.0, actual: 19343.0, details: [] },
            { name: "ÙƒÙŠØªØ§", foodics: 122761.55, actual: 0, details: [] },
            { name: "ÙƒØ§Ø´", foodics: 3486.5, actual: 0, details: [] }
        ]
    },

    {
        id: 6,
        name: "Ù…Ø·Ø¹Ù… Ø¨Ø±ÙŠØ³Øª - ÙØ±Ø¹ Ø§Ù„Ù†Ø³ÙŠÙ…",
        items: [
            { name: "Ø§Ù„Ø¨Ù†Ùƒ (Ù…Ø¯Ù‰/Ø§Ù†Ù…Ø§Ø¡)", foodics: 12443.0, actual: 12443.0, details: [] },
            { name: "ØªØ·Ø¨ÙŠÙ‚ Ø¬Ø§Ù‡Ø²", foodics: 27067.8, actual: 27067.7, details: [] },
            { name: "ØªØ·Ø¨ÙŠÙ‚ Ø°Ø§ Ø´ÙŠÙØ²", foodics: 8568.0, actual: 8568.0, details: [] },
            { name: "ØªØ·Ø¨ÙŠÙ‚ Ø¨Ø±ÙŠØ³Øª", foodics: 3747.1, actual: 3747.1, details: [] },
            { name: "Ù‡Ù†Ù‚Ø±Ø³ØªÙŠØ´Ù†", foodics: 10632.0, actual: 10695.0, details: [] },
            { name: "ÙƒÙŠØªØ§", foodics: 75835.15, actual: 0, details: [] },
            { name: "ÙƒØ§Ø´", foodics: 3940.0, actual: 0, details: [] }
        ]
    },

    {
        id: 7,
        name: "Ù…Ø·Ø¹Ù… Ø¨Ø±ÙŠØ³Øª - ÙØ±Ø¹ Ø§Ù„Ø¹Ù‚ÙŠÙ‚",
        items: [
            { name: "Ø§Ù„Ø¨Ù†Ùƒ (Ù…Ø¯Ù‰/Ø§Ù†Ù…Ø§Ø¡)", foodics: 23369.5, actual: 23383.5, details: [] },
            { name: "ØªØ·Ø¨ÙŠÙ‚ Ø¬Ø§Ù‡Ø²", foodics: 73770.9, actual: 73770.9, details: [] },
            { name: "ØªØ·Ø¨ÙŠÙ‚ Ø°Ø§ Ø´ÙŠÙØ²", foodics: 20363.0, actual: 20363.0, details: [] },
            { name: "ØªØ·Ø¨ÙŠÙ‚ Ø¨Ø±ÙŠØ³Øª", foodics: 6630.4, actual: 6630.4, details: [] },
            { name: "Ù‡Ù†Ù‚Ø±Ø³ØªÙŠØ´Ù†", foodics: 8972.0, actual: 8972.0, details: [] },
            { name: "ÙƒÙŠØªØ§", foodics: 65659.45, actual: 0, details: [] },
            { name: "ÙƒØ§Ø´", foodics: 2861.0, actual: 0, details: [] }
        ]
    }
];

/* Ø±Ù‚Ù… ØªÙ†Ø³ÙŠÙ‚ */
const formatNumber = (num) => {
    if (num === undefined || num === null || isNaN(num)) return "-";
    return new Intl.NumberFormat("en-US", {
        minimumFractionDigits: 2,
        maximumFractionDigits: 2,
    }).format(num);
};

/* ---------------------------------------------
   ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† GitHub
---------------------------------------------- */
async function loadDataFromGitHub() {
    const DATA_URL = `https://raw.githubusercontent.com/${GITHUB_USERNAME}/${GITHUB_REPO}/main/data.json`;

    try {
        const res = await fetch(DATA_URL + "?cache=" + Date.now());
        if (!res.ok) return DEFAULT_DATA;

        const json = await res.json();
        return json.branches || DEFAULT_DATA;
    } catch {
        return DEFAULT_DATA;
    }
}

/* -------------------------------
   Ù…ÙˆØ¯Ø§Ù„ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªÙØ§ØµÙŠÙ„
-------------------------------- */
const DetailsModal = ({ isOpen, onClose, itemTitle, details, onSave }) => {
    const [localDetails, setLocalDetails] = useState([]);
    const [newDate, setNewDate] = useState("");
    const [newNote, setNewNote] = useState("");
    const [newAmount, setNewAmount] = useState("");

    useEffect(() => {
        if (isOpen) {
            setLocalDetails(details ? [...details] : []);
            setNewDate(""); setNewNote(""); setNewAmount("");
        }
    }, [isOpen, details]);

    const addDetail = () => {
        if (!newDate || !newNote || !newAmount) return;
        setLocalDetails([...localDetails, {
            date: newDate, note: newNote, amount: parseFloat(newAmount)
        }]);
        setNewNote(""); setNewAmount("");
    };

    const removeDetail = (i) =>
        setLocalDetails(localDetails.filter((_, idx) => idx !== i));

    const handleSave = () => { onSave(localDetails); onClose(); };

    if (!isOpen) return null;

    const total = localDetails.reduce((s, d) => s + d.amount, 0);

    return (
        <div className="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-[60] p-4 backdrop-blur-sm">
            <div className="bg-white rounded-lg shadow-xl w-full max-w-lg max-h-[80vh] overflow-hidden flex flex-col">
                <div className="bg-indigo-700 text-white px-4 py-3 flex justify-between">
                    <h3 className="font-bold">ØªÙØ§ØµÙŠÙ„ Ø§Ù„ÙØ±ÙˆÙ‚Ø§Øª: {itemTitle}</h3>
                    <button onClick={onClose}>âœ•</button>
                </div>

                <div className="p-4 overflow-y-auto flex-1">
                    <div className="bg-white p-3 rounded border mb-4">
                        <h4 className="text-sm font-bold text-indigo-800 mb-2">
                            Ø¥Ø¶Ø§ÙØ© Ø³Ø¨Ø¨ Ø¬Ø¯ÙŠØ¯
                        </h4>

                        <div className="grid grid-cols-3 gap-2 mb-2">
                            <input type="date" value={newDate}
                                onChange={(e) => setNewDate(e.target.value)}
                                className="border p-1 rounded text-sm" />

                            <input type="number" value={newAmount}
                                onChange={(e) => setNewAmount(e.target.value)}
                                placeholder="Ø§Ù„Ù…Ø¨Ù„Øº"
                                className="border p-1 rounded text-sm" />
                        </div>

                        <input type="text" value={newNote}
                            onChange={(e) => setNewNote(e.target.value)}
                            placeholder="Ø§Ù„Ø³Ø¨Ø¨"
                            className="border p-1 rounded text-sm w-full mb-2" />

                        <button onClick={addDetail}
                            className="w-full bg-indigo-600 text-white py-1 rounded text-sm">
                            Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ù‚Ø§Ø¦Ù…Ø©
                        </button>
                    </div>

                    <table className="w-full text-sm border rounded bg-white">
                        <thead className="bg-gray-100">
                            <tr>
                                <th className="p-2 border-b">Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                                <th className="p-2 border-b">Ø§Ù„Ø³Ø¨Ø¨</th>
                                <th className="p-2 border-b text-center">Ø§Ù„Ù…Ø¨Ù„Øº</th>
                                <th className="p-2 border-b"></th>
                            </tr>
                        </thead>

                        <tbody>
                            {localDetails.map((d, i) => (
                                <tr key={i} className="border-b">
                                    <td className="p-2">{d.date}</td>
                                    <td className="p-2">{d.note}</td>
                                    <td className="p-2 text-center num-font font-bold">{formatNumber(d.amount)}</td>
                                    <td className="p-2 text-center">
                                        <button
                                            className="text-red-500"
                                            onClick={() => removeDetail(i)}
                                        >Ã—</button>
                                    </td>
                                </tr>
                            ))}
                            {localDetails.length === 0 && (
                                <tr><td colSpan="4" className="p-4 text-center text-gray-400">
                                    Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙØ§ØµÙŠÙ„
                                </td></tr>
                            )}
                        </tbody>

                        <tfoot>
                            <tr>
                                <td colSpan="2" className="p-2">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:</td>
                                <td className="p-2 num-font">{formatNumber(total)}</td>
                                <td></td>
                            </tr>
                        </tfoot>
                    </table>
                </div>

                <div className="p-3 bg-gray-100 flex justify-end">
                    <button onClick={onClose} className="px-4 py-1 bg-white border rounded mx-2">
                        Ø¥ØºÙ„Ø§Ù‚
                    </button>
                    <button onClick={handleSave} className="px-4 py-1 bg-green-600 text-white rounded">
                        Ø­ÙØ¸
                    </button>
                </div>
            </div>
        </div>
    );
};
/* -------------------------------------------
   Ù†Ø§ÙØ°Ø© Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© (Edit Modal)
-------------------------------------------- */
const EditModal = ({ isOpen, onClose, data, onSave, currentLogo, onLogoChange }) => {
    const [selectedBranchId, setSelectedBranchId] = useState(data[0]?.id || 1);
    const [localData, setLocalData] = useState(JSON.parse(JSON.stringify(data)));
    const [detailsModalOpen, setDetailsModalOpen] = useState(false);
    const [activeDetailItem, setActiveDetailItem] = useState(null);
    const fileInputRef = useRef(null);

    useEffect(() => {
        if (isOpen) setLocalData(JSON.parse(JSON.stringify(data)));
    }, [isOpen, data]);

    const handleInputChange = (branchId, itemIndex, field, value) => {
        const newData = [...localData];
        const bIndex = newData.findIndex((b) => b.id === parseInt(branchId));
        if (bIndex > -1) {
            newData[bIndex].items[itemIndex][field] = parseFloat(value) || 0;
            setLocalData(newData);
        }
    };

    const openDetails = (branchId, itemIndex) => {
        setActiveDetailItem({ branchId, itemIndex });
        setDetailsModalOpen(true);
    };

    const saveDetails = (newDetails) => {
        if (activeDetailItem) {
            const newData = [...localData];
            const bIndex = newData.findIndex(b => b.id === parseInt(activeDetailItem.branchId));
            if (bIndex > -1) {
                newData[bIndex].items[activeDetailItem.itemIndex].details = newDetails;
                setLocalData(newData);
            }
        }
    };

    const handleSave = () => { onSave(localData); onClose(); };

    const handleLogoUpload = (e) => {
        const file = e.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onloadend = () => { onLogoChange(reader.result); };
            reader.readAsDataURL(file);
        }
    };

    if (!isOpen) return null;

    const activeBranch = localData.find(b => b.id === parseInt(selectedBranchId));
    const activeItemForDetails =
        activeDetailItem
            ? localData.find(b => b.id === parseInt(activeDetailItem.branchId))?.items[activeDetailItem.itemIndex]
            : null;

    return (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[50] backdrop-blur-sm p-4">
            <div className="bg-white w-full max-w-5xl max-h-[90vh] rounded-xl shadow-2xl overflow-hidden flex flex-col">

                {/* HEADER */}
                <div className="bg-gray-800 text-white px-6 py-4 flex justify-between">
                    <h2 className="text-xl font-bold">ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙØ±ÙˆØ¹</h2>
                    <button onClick={onClose} className="text-gray-300 hover:text-white">âœ•</button>
                </div>

                {/* SELECT & LOGO */}
                <div className="bg-gray-50 p-4 border-b flex justify-between">
                    <div className="w-1/2 pr-2">
                        <label className="font-bold text-gray-600 text-sm mb-1 block">Ø§Ø®ØªØ± Ø§Ù„ÙØ±Ø¹:</label>
                        <select
                            value={selectedBranchId}
                            onChange={(e) => setSelectedBranchId(e.target.value)}
                            className="w-full border rounded-lg p-3 font-bold"
                        >
                            {localData.map(branch => (
                                <option key={branch.id} value={branch.id}>{branch.name}</option>
                            ))}
                        </select>
                    </div>

                    <div className="w-1/2 pl-2">
                        <label className="font-bold text-gray-600 text-sm mb-1 block">ØªØºÙŠÙŠØ± Ø§Ù„Ø´Ø¹Ø§Ø±:</label>
                        <div className="flex items-center gap-3">
                            <div className="w-12 h-12 border rounded bg-white flex items-center justify-center overflow-hidden">
                                <img src={currentLogo} className="w-full h-full object-contain" />
                            </div>
                            <input
                                type="file"
                                ref={fileInputRef}
                                accept="image/*"
                                onChange={handleLogoUpload}
                                className="hidden"
                            />
                            <button
                                onClick={() => fileInputRef.current.click()}
                                className="bg-blue-100 text-blue-700 px-3 py-2 rounded font-bold text-sm"
                            >
                                Ø§Ø®ØªØ± ØµÙˆØ±Ø© Ø§Ù„Ø´Ø¹Ø§Ø±
                            </button>
                        </div>
                    </div>
                </div>

                {/* BODY */}
                <div className="p-5 overflow-y-auto flex-1">
                    {activeBranch && (
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                            {activeBranch.items.map((item, idx) => (
                                <div key={idx} className="border p-4 rounded-lg shadow-sm bg-white">
                                    <div className="flex justify-between items-center mb-3 border-b pb-2">
                                        <span className="font-bold">{item.name}</span>
                                        <button
                                            onClick={() => openDetails(selectedBranchId, idx)}
                                            className="text-xs bg-indigo-100 text-indigo-700 px-2 py-1 rounded"
                                        >
                                            ğŸ“ {item.details?.length || 0} ØªÙØ§ØµÙŠÙ„
                                        </button>
                                    </div>

                                    <div className="grid grid-cols-2 gap-3">
                                        <div>
                                            <label className="text-xs font-bold text-gray-500">Foodics</label>
                                            <input
                                                type="number"
                                                step="0.01"
                                                value={item.foodics}
                                                onChange={(e) =>
                                                    handleInputChange(selectedBranchId, idx, "foodics", e.target.value)
                                                }
                                                className="w-full border rounded p-2 text-left dir-ltr"
                                            />
                                        </div>

                                        <div>
                                            <label className="text-xs font-bold text-gray-500">Actual</label>
                                            <input
                                                type="number"
                                                step="0.01"
                                                value={item.actual}
                                                onChange={(e) =>
                                                    handleInputChange(selectedBranchId, idx, "actual", e.target.value)
                                                }
                                                className="w-full border rounded p-2 text-left dir-ltr"
                                            />
                                        </div>
                                    </div>
                                </div>
                            ))}
                        </div>
                    )}
                </div>

                {/* FOOTER */}
                <div className="bg-gray-100 px-6 py-4 border-t flex justify-end gap-3">
                    <button
                        onClick={onClose}
                        className="px-6 py-2 bg-white border rounded font-bold"
                    >
                        Ø¥Ù„ØºØ§Ø¡
                    </button>
                    <button
                        onClick={handleSave}
                        className="px-8 py-2 bg-green-600 text-white rounded font-bold"
                    >
                        Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª
                    </button>
                </div>
            </div>

            {/* ØªÙØ§ØµÙŠÙ„ */}
            <DetailsModal
                isOpen={detailsModalOpen}
                onClose={() => setDetailsModalOpen(false)}
                itemTitle={activeItemForDetails?.name}
                details={activeItemForDetails?.details}
                onSave={saveDetails}
            />
        </div>
    );
};

/* -------------------------------------------
        ØµÙØ­Ø© Ø§Ù„ÙØ±ÙˆÙ‚Ø§Øª
-------------------------------------------- */
const DifferenceReportView = ({ data }) => {
    return (
        <div className="space-y-8">
            {data.map((branch) => {
                const diffs = branch.items.filter(item => {
                    const excluded = item.name.includes("ÙƒÙŠØªØ§") || item.name.includes("ÙƒØ§Ø´");
                    const diff = (item.actual || 0) - (item.foodics || 0);
                    return (!excluded && Math.abs(diff) > 0.01) || (item.details?.length > 0);
                });

                if (diffs.length === 0) return null;

                return (
                    <div 
                        key={branch.id}
                        className="diff-card bg-[#f5f5f5] border border-gray-300 rounded-lg overflow-hidden"
                        style={{
                            pageBreakInside: "avoid",
                            breakInside: "avoid"
                        }}
                    >
                        <div className="px-4 py-3 bg-[#e7e7e7] border-b font-bold text-lg">
                            {branch.name}
                        </div>

                        <table className="w-full text-sm">
                            <thead>
                                <tr className="bg-white border-b">
                                    <th className="p-2 text-right font-bold">Ø§Ù„ØªØ·Ø¨ÙŠÙ‚</th>
                                    <th className="p-2 text-center font-bold">Ø§Ù„Ø­Ø§Ù„Ø©</th>
                                </tr>
                            </thead>

                            <tbody>
                                {diffs.map((item, idx) => {
                                    const diff = (item.actual || 0) - (item.foodics || 0);

                                    let label = "";
                                    let cls = "";

                                    if (diff > 0.01) {
                                        label = `${formatNumber(diff)} â€” Ø²ÙŠØ§Ø¯Ø©`;
                                        cls = "text-green-600 font-bold";
                                    } else if (diff < -0.01) {
                                        label = `${formatNumber(Math.abs(diff))} â€” Ø¹Ø¬Ø²`;
                                        cls = "text-red-600 font-bold";
                                    }

                                    return (
                                        <React.Fragment key={idx}>
                                            <tr className="bg-white border-b">
                                                <td className="p-2 font-bold">{item.name}</td>
                                                <td className={`p-2 text-center ${cls}`}>{label}</td>
                                            </tr>

                                            {item.details?.length > 0 && (
                                                <tr>
                                                    <td colSpan="2" className="p-0">
                                                        <table className="w-full text-xs">
                                                            <thead className="bg-white border-b">
                                                                <tr>
                                                                    <th className="p-2 text-right">Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                                                                    <th className="p-2 text-right">Ø§Ù„Ø³Ø¨Ø¨</th>
                                                                    <th className="p-2 text-center">Ø§Ù„Ù…Ø¨Ù„Øº</th>
                                                                </tr>
                                                            </thead>

                                                            <tbody>
                                                                {item.details.map((d, i) => (
                                                                    <tr key={i} className="border-b bg-white">
                                                                        <td className="p-2">{d.date}</td>
                                                                        <td className="p-2">{d.note}</td>
                                                                        <td className="p-2 text-center num-font font-bold">
                                                                            {formatNumber(d.amount)}
                                                                        </td>
                                                                    </tr>
                                                                ))}
                                                            </tbody>

                                                            <tfoot className="bg-white">
                                                                <tr>
                                                                    <td colSpan="2" className="p-2 font-bold">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</td>
                                                                    <td className="p-2 text-center num-font font-bold text-red-600">
                                                                        {formatNumber(
                                                                            item.details.reduce((s, d) => s + d.amount, 0)
                                                                        )}
                                                                    </td>
                                                                </tr>
                                                            </tfoot>
                                                        </table>
                                                    </td>
                                                </tr>
                                            )}
                                        </React.Fragment>
                                    );
                                })}
                            </tbody>
                        </table>
                    </div>
                );
            })}
        </div>
    );
};

/* -------------------------------------------
        ØµÙØ­Ø© Ø§Ù„Ù…Ù„Ø®Øµ
-------------------------------------------- */
const BranchTable = ({ data }) => {
    const items = data.items.map(item => ({
        ...item,
        diff: (item.actual || 0) - (item.foodics || 0),
        excluded: item.name.includes("ÙƒÙŠØªØ§") || item.name.includes("ÙƒØ§Ø´")
    }));

    const sumFoodics = items.reduce((s, i) => s + i.foodics, 0);

    return (
        <div className="branch-card border rounded-lg overflow-hidden mb-6">
            <div className="bg-gray-200 px-4 py-3 font-bold border-b text-lg">
                {data.name}
            </div>

            <table className="w-full text-sm">
                <thead className="bg-gray-100 border-b">
                    <tr>
                        <th className="p-2 text-right">Ø§Ù„Ø¨Ù†Ø¯</th>
                        <th className="p-2 text-center">Foodics</th>
                        <th className="p-2 text-center">Actual</th>
                        <th className="p-2 text-center">Ø§Ù„ÙØ±Ù‚</th>
                    </tr>
                </thead>

                <tbody>
                    {items.map((item, idx) => (
                        <tr key={idx} className="border-b">
                            <td className="p-2 font-bold">{item.name}</td>
                            <td className="p-2 text-center num-font">{formatNumber(item.foodics)}</td>
                            <td className="p-2 text-center num-font">{formatNumber(item.actual)}</td>
                            <td className={`p-2 text-center font-bold num-font ${
                                item.excluded
                                    ? "text-gray-400"
                                    : Math.abs(item.diff) < 0.01
                                        ? "text-gray-500"
                                        : item.diff > 0
                                            ? "text-green-600"
                                            : "text-red-600"
                            }`}>
                                {item.excluded ? "-" : formatNumber(item.diff)}
                            </td>
                        </tr>
                    ))}
                </tbody>

                <tfoot className="bg-gray-100 font-bold">
                    <tr>
                        <td className="p-2">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</td>
                        <td className="p-2 text-center num-font">{formatNumber(sumFoodics)}</td>
                        <td className="p-2 text-center">-</td>
                        <td className="p-2 text-center">-</td>
                    </tr>
                </tfoot>
            </table>
        </div>
    );
};

/* -------------------------------------------
        ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± Ù‚Ø¨Ù„ ÙØªØ­ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
-------------------------------------------- */
const PasswordModal = ({ onSuccess }) => {
    const [password, setPassword] = useState("");

    return (
        <div className="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-[80] backdrop-blur-sm">
            <div className="bg-white w-80 p-6 rounded-lg shadow-xl">
                <h2 className="text-xl font-bold text-center mb-4">Ø§Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</h2>

                <input
                    type="password"
                    className="border p-2 w-full text-center rounded mb-4"
                    value={password}
                    onChange={(e) => setPassword(e.target.value)}
                    placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢"
                />

                <div className="flex justify-between">
                    <button
                        onClick={() => setPassword("")}
                        className="px-4 py-2 bg-gray-300 rounded"
                    >
                        Ø¥Ù„ØºØ§Ø¡
                    </button>

                    <button
                        onClick={() => {
                            if (password === "wael123") {
                                onSuccess();
                            } else {
                                alert("âŒ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©");
                            }
                        }}
                        className="px-4 py-2 bg-blue-600 text-white rounded"
                    >
                        Ø¯Ø®ÙˆÙ„
                    </button>
                </div>
            </div>
        </div>
    );
};

/* -------------------------------------------
        Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ
-------------------------------------------- */
const App = () => {
    const [reportData, setReportData] = useState([]);
    const [logoSrc, setLogoSrc] = useState("Logo.png");
    const [showEdit, setShowEdit] = useState(false);
    const [showPassword, setShowPassword] = useState(false);
    const [viewMode, setViewMode] = useState("summary");

    useEffect(() => {
        loadDataFromGitHub().then(setReportData);
    }, []);

    const handleSave = (newData) => {
        saveDataToGitHub(newData);
        setReportData(newData);
    };

    return (
        <div className="max-w-[210mm] mx-auto p-6 bg-white min-h-screen">

            {/* HEADER */}
            <div className="flex justify-between items-center pb-4 mb-6 border-b-4 border-black">

                <div className="flex items-center gap-4">
                    <div className="w-20 h-20 border rounded overflow-hidden bg-gray-50">
                        <img
                            src={logoSrc}
                            className="w-full h-full object-contain"
                            onError={(e) => { e.target.style.display = "none"; }}
                        />
                    </div>

                    <div>
                        <h1 className="text-3xl font-black">
                            {viewMode === "summary" ? "ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø©" : "ØªÙ‚Ø±ÙŠØ± Ø§Ù„ÙØ±ÙˆÙ‚Ø§Øª"}
                        </h1>
                        <p className="font-bold text-gray-700">Ù…Ø·Ø§Ø¹Ù… Ø¨Ø±ÙŠØ³Øª â€” 7 ÙØ±ÙˆØ¹</p>
                    </div>
                </div>

                <div className="flex gap-2 no-print">
                    <button
                        className="bg-blue-600 text-white px-4 py-2 rounded font-bold"
                        onClick={() => setShowPassword(true)}
                    >
                        ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª / Ø§Ù„Ø´Ø¹Ø§Ø±
                    </button>

                    <button
                        onClick={() => setViewMode(viewMode === "summary" ? "details" : "summary")}
                        className="bg-yellow-500 hover:bg-yellow-600 text-white px-4 py-2 rounded font-bold"
                    >
                        {viewMode === "summary" ? "Ø¹Ø±Ø¶ Ø§Ù„ÙØ±ÙˆÙ‚Ø§Øª" : "Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù„Ø®Øµ"}
                    </button>

                    <button
                        onClick={() => window.print()}
                        className="bg-black text-white px-4 py-2 rounded font-bold"
                    >
                        Ø·Ø¨Ø§Ø¹Ø©
                    </button>
                </div>

            </div>

            {/* BODY */}
            {viewMode === "summary" ? (
                <div>
                    {reportData.map(branch => (
                        <BranchTable key={branch.id} data={branch} />
                    ))}
                </div>
            ) : (
                <DifferenceReportView data={reportData} />
            )}

            {/* FOOTER */}
            <div className="mt-6 pt-4 border-t-2 border-black text-sm text-gray-700 font-bold no-print flex justify-between">
                <span>ØªÙ… Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡ Ø¨ÙˆØ§Ø³Ø·Ø©: ÙˆØ§Ø¦Ù„ Ø£Ø­Ù…Ø¯</span>
                <span>Ù†Ù‡Ø§ÙŠØ© Ø§Ù„ØªÙ‚Ø±ÙŠØ±</span>
            </div>

            {/* PASSWORD MODAL */}
            {showPassword && (
                <PasswordModal onSuccess={() => {
                    setShowPassword(false);
                    setShowEdit(true);
                }} />
            )}

            {/* EDIT MODAL */}
            {showEdit && (
                <EditModal
                    isOpen={showEdit}
                    onClose={() => setShowEdit(false)}
                    data={reportData}
                    onSave={handleSave}
                    currentLogo={logoSrc}
                    onLogoChange={setLogoSrc}
                />
            )}

        </div>
    );
};

ReactDOM.createRoot(document.getElementById("root")).render(<App />);

</script>
</body>
</html>
